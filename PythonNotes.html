<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>Python Notes</title>
    <meta name="generator" content="emacs-wiki.el" />
    <meta http-equiv="Content-Type"
          content="text/html; charset=utf-8" />
    <link rel="made" href="mailto:cyberpsyche[AT]gmail.com" />
    <link rel="home" href="WelcomePage.html" />
    <link rel="index" href="WikiIndex.html" />
    <link rel="stylesheet" type="text/css" href="main.css"><script type="text/javascript">
function showToolTip(machaine) {
  if (machaine != "")   {
    document.getElementById('tooltip').innerHTML     = machaine;
    document.getElementById('tooltipbox').style.visibility = 'visible';
  }
}
function hide() {
  document.getElementById('tooltip').innerHTML     = '';
  document.getElementById('tooltipbox').style.visibility = 'hidden';
}
</script>
<div class="menu">
<div class="menuitem">
  <a href="WelcomePage.html">Wiki</a>
</div>

<div class="menuitem">
  <a href="../workwiki/WelcomePage.html">work</a>
</div>

</div><!-- menu ends here -->
<div id="tooltipbox">
<div id="tooltip"></div>
</div>
  </head>
  <body>
    <h1 id="top">Python Notes</h1>

    <!-- Page published by Emacs Wiki begins here -->
<h3>python programming</h3>

<h4>exec  and  eval</h4>

<pre class="example">&gt;&gt;&gt; d = {}
&gt;&gt;&gt; exec(file('~/Test/python/test.py'), d)
&gt;&gt;&gt; d.get('func')(1)
等于
&gt;&gt;&gt; eval('func(1)', d)
</pre>

<h4>logging 工具</h4>

<p>
用于调试

</p>

<h4>python -i  or  ipython </h4>

<p>
交互模式

</p>

<h4>用dict模拟switch语句</h4>

<pre class="example">&gt;&gt;&gt; d={'1':lambda x:x+1,'2':lambda x:x+2,'3':lambda x:x+3}
&gt;&gt;&gt; d['2'](10)
12
&gt;&gt;&gt; d['3'](10)
13
</pre>

<h4>append to file</h4>

<p>
use "a" mode to open a file.

</p>

<h3>python modules</h3>

<h4>HTML/XML  parser</h4>

<p>
Beautiful Soup

</p>

<p>
<a href="http://www.crummy.com/software/BeautifulSoup/">http://www.crummy.com/software/BeautifulSoup/</a>

</p>

<h4>JPype</h4>

<p>
JPype is an effort to allow python programs full access to java class libs.

</p>

<p>
<a href="http://jpype.sourceforge.net">http://jpype.sourceforge.net</a>

</p>

<p>
Python seems to be the greatest glue language I've ever saw.

</p>

<h4>json</h4>

<p>
simplejson  <a href="http://pypi.python.org/pypi/simplejson">http://pypi.python.org/pypi/simplejson</a>

</p>

<h4>pdb</h4>

<p>
debug tools. 

</p>

<p>
usage:

</p>

<pre class="example">python -m pdb mymodule.py
</pre>

<p>
or 

</p>

<pre class="example">&gt;&gt;&gt; import pdb
&gt;&gt;&gt; import mymodule
&gt;&gt;&gt; pdb.run(‘mymodule.test()’)
</pre>

<h4>MS SQL and Sybase</h4>

<p>
需要安装以下的modules:

</p>

<p>
<strong>libct3</strong>  -------- 基本库

</p>

<p>
<strong>libsybdb5</strong>  --------- 库文件

</p>

<p>
<strong>freetds-dev</strong>   ----------- 库文件和头文件

</p>

<p>
<strong>sqsh</strong>  ----------- 基于freetds的命令行ms sql / sybase 查询工具

</p>

<p>
MSSQL module for Python

</p>

<p>
<a href="http://www.object-craft.com.au/projects/mssql/">http://www.object-craft.com.au/projects/mssql/</a>

</p>

<p>
下载 mssql-0.9

</p>

<dl>
<dt>安装命令</dt>
<dd>
python setup.py install
</dd>
</dl>

<h4>feedparser</h4>

<p>
<a href="http://feedparser.org/">http://feedparser.org/</a>

</p>

<h4>celementtree</h4>

<p>
cElementTree为elementtree的改进版。

</p>

<pre class="example">for event, elem in ElementTree.iterparse(XML_FILE):
    if elem.tag == 'item':
        #elem.clear()
        print elem.attrib.get(&quot;id&quot;)
        title = elem.text
</pre>

<h4>Scientific Python</h4>

<p>
运行效率 numpy > numarray > numeric，其中numeric已经不维护，numarray官方也建议用户迁移至numpy。

</p>

<h3>Python on Nokia Series 60</h3>

<h4>Platform </h4>
Install the python for series 60 SIS file into the mobilephone (I have a Nokia N-Gage QD) based on Symbian operating system, and you will find a symbolic icon of PYTHON enlisted on the menu board. You can triger a interactive python console or run python-scripts in your cellphone. Nokia and Symbian provided API for this programming environment.

</p>

<p>
If you want to build a develope environment on your PC, your should install a SDK from Nokia:

</p>

<p>
<a href="http://www.forum.nokia.com/main/1%2c6566%2c034-821%2c00.html">http://www.forum.nokia.com/main/1&#44;6566&#44;034-821&#44;00.html</a>

</p>

<p>
And you can also find a Developer Discussion Board of Python on that page.

</p>

<h3>Python Encoding</h3>

<h4>Using GB2312 coding in python scripts</h4>

<pre class="example">#!/usr/bin/python
# -*- coding: gb2312 -*-
</pre>

<p>
已上code的声明方法等价于：

</p>

<pre class="example"># coding=gb2312
or
# coding:gb2312
</pre>

<h4>Python 编码</h4>

<p>
python的编码可分为普通的str型和unicode型两种。

</p>

<pre class="example">&gt;&gt;&gt; a = '财神'
&gt;&gt;&gt; a
'\xe8\xb4\xa2\xe7\xa5\x9e'
&gt;&gt;&gt; b = unicode(a, 'utf-8')
&gt;&gt;&gt; b
u'\u8d22\u795e'
&gt;&gt;&gt; type(a)
&lt;type 'str'&gt;
&gt;&gt;&gt; type(b)
&lt;type 'unicode'&gt;
</pre>

<p>
unicode型的字符串不能直接存贮，需要转义为str型才行。

</p>

<pre class="example">&gt;&gt;&gt; b.encode('utf-8')
'\xe8\xb4\xa2\xe7\xa5\x9e'
</pre>

<p>
用 print a 显示原字串。

</p>

<h4>Python编码处理</h4>

<pre class="example">reload(sys)
sys.setdefaultencoding('utf8')
</pre>

<h3>Python Database Operation</h3>

<h4>Access MySQL datapool</h4>

<pre class="example">import MySQLdb

connection = MySQLdb.connect(host=&quot;xxx.xxx.xxx.xxx&quot;, db=&quot;dbname&quot;, port=3306,\
                           user=&quot;root&quot;, passwd=&quot;let_me_in&quot;)
con = connection.cursor()
try:
      sql_statement=&quot;select bush,rice from assholes order by stupid limit 2&quot;
      con.execute(sql_statement)
      con.scroll(0)

      i = 0
      while i &lt; con.rowcount :
             row = con.fetchone()
             stupid[i] = ''.join(&quot;%s&quot; % row[0])
             i += 1
except:
      status = &quot;Damn,MySQLdb query situation is elusive.&quot;

connection.close()
</pre>

<h3>Python Image Library</h3>

<h4>PIL exclusive pilfont creation</h4>

<pre class="example">otf2bdf -p 16 arial.ttf &gt; arial.bdf
python pilfont.py arial.bdf
</pre>

<p>
Then you can get arial.pbm and arial.pil, use them like this:

</p>

<pre class="example">font = ImageFont.load(&quot;arial.pil&quot;)
draw.text((10, 25), &quot;Hello World!&quot;, font=font)
</pre>

<h4>Draw Chinese characters with PIL </h4>

<pre class="example">font = ImageFont.truetype(&quot;/usr/share/fonts/truetype/mac-os-x/stheiti.ttf&quot;, 48)
draw.text((10, 25),unicode('你好，世界。 100℃', 'utf-8'), font=font, fill=&quot;#FF0000&quot;)
</pre>

<h3>Python Shell</h3>

<h4>交互模式下执行脚本</h4>

<pre class="example">&gt;&gt;&gt; os.system('demo.py')
or 
&gt;&gt;&gt; import demo
</pre>

<h4>import search path</h4>

<p>
方法一：

</p>

<pre class="example">export PYTHONPATH=&quot;/path/to/python/packages/&quot;
python want_to_exec.py
</pre>

<p>
方法二：

</p>

<pre class="example">sys.path.append('/path/to/pythoh/packages/')
os.system('want_to_exec.py')
</pre>

<h4>Python Pipe</h4>

<pre class="example">import os
s = os.popen('wget -O - http://www.google.com').read()
</pre>

<h4>python tip</h4>

<pre class="example">&gt;&gt;&gt; def f(a, **k):
...     print a
...     print k
... 
&gt;&gt;&gt; f(c=1, a=1, b=&quot;aaa&quot;)
output :
1
{'c': 1, 'b': 'aaa'}
</pre>

<h3>Python FTP </h3>

<pre class="example">from ftplib import FTP
import sys
ftp=FTP()
ftp.set_debuglevel(2)
ftp.connect('ftp.i139.cn','21')
ftp.login('weather','As!weath%erPire')
print ftp.getwelcome()
ftp.cwd('/')
bufsize = 1024
filename=sys.argv[1]
file_handler = open(filename,'rb')
#ftp.sendcmd('prompt')
ftp.set_pasv(1)
ftp.storbinary('STOR '+filename,file_handler,bufsize) #Upload file
ftp.set_debuglevel 
file_handler.close() #Close file
ftp.quit
</pre>

<h3>Django</h3>

<h4>Install Django</h4>

<pre class="example">python setup.py install
</pre>

<h4>Create a new project</h4>

<pre class="example">django-admin.py startproject &lt;prj-name&gt;
</pre>

<p>
admonition : a django project is comprised of some apps, u can adjust the apps in settins.py file INSTALLD_APPS section.

</p>

<h4>Create database tables</h4>

<pre class="example">python manage.py syncdb
</pre>

<p>
admonition : u can create a auth user in this procession. and u can execute this command anytime as you want, it would create any new tables after your last ran.

</p>

<h4>Run the testing server</h4>

<pre class="example">python manager.py runserver &lt;PORT&gt;
</pre>

<p>
admonition : PORT default is 8000 

</p>

<h4>Create app</h4>

<pre class="example">python manage.py startapp &lt;app-name&gt;
</pre>

<p>
then edit the models.py, for example

</p>

<pre class="example">from django.db import models

# Create your models here.
class CreateTag(models.Model):
        tagname = models.CharField(maxlength=100)
        pub_date = models.DateTimeField('date published')

class VoteTag(models.Model):
        tag = models.ForeignKey(CreateTag)
        pros = models.IntegerField()
        cons = models.IntegerField()

class CommentTag(models.Model):
        tag = models.ForeignKey(CreateTag)
        comment = models.CharField(maxlength=4000)

class ViewTag(models.Model):
        tag = models.ForeignKey(CreateTag)
        views = models.IntegerField()
</pre>

<p>
and u should insert the added app into project's settings.py file INSTALLED_APPS section.

</p>

<pre class="example">INSTALLED_APPS = (
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.sites',
    'prj-name.app-name'
)
</pre>

<h4>Check the sql of your app models</h4>

<p>
Output the sql of app models

</p>

<pre class="example">python manage.py sql app-name
</pre>

<p>
Checks for any error in your construction of models

</p>

<pre class="example">python manage.py validate app-name
</pre>

<p>
Outputs any initial data required for Django's admin framework and your models.

</p>

<pre class="example">python manage.py sqlinitialdata app-name
</pre>

<p>
Outputs the necessary &ldquo;DROP TABLE&ldquo; statements for this app, according to which tables already exist in your database (if any).

</p>

<pre class="example">python manage.py sqlclear app-name
</pre>

<p>
Outputs the &ldquo;CREATE INDEX&ldquo; statements for this app.

</p>

<pre class="example">python manage.py sqlindexes app-name
</pre>

<p>
A combination of all the SQL from the 'sql', 'sqlinitialdata', and 'sqlindexes' commands.

</p>

<pre class="example">python manage.py sqlall app-name
</pre>

<h4>To invoke the Python shell with prj-name on sys.path and setting the settings.py as DJANGO_SETTINGS_MODULE environment variable</h4>

<pre class="example">python manage.py shell
</pre>

<h4>To use Django environment</h4>

<pre class="example">export PYTHONPATH=/home/sam/www/
export DJANGO_SETTINGS_MODULE=django-proj.settings
</pre>

<h4>A example of django configuration for Apache2.x with mod_python</h4>

<pre class="example">&lt;VirtualHost *:80&gt;
        ServerName apple
        ServerAlias apple.cn
        ServerAdmin cyberpsyche@gmail.com

        RewriteEngine On
        RewriteRule ^/tqyb/$ /banana.py?m=home [L]
        DocumentRoot /home/sam/www/apple/
        &lt;Directory /&gt;
                Options Indexes FollowSymLinks
                AllowOverride None
        &lt;/Directory&gt;
        &lt;Directory /home/sam/www/apple/&gt;
                Options Indexes FollowSymLinks
                AllowOverride None
                Order allow,deny
                Allow from all
        &lt;/Directory&gt;

        &lt;Location &quot;/apple/&quot;&gt;
                SetHandler mod_python
                PythonHandler django.core.handlers.modpython
                PythonPath &quot;['/home/sam/www'] + sys.path&quot;
                SetEnv DJANGO_SETTINGS_MODULE apple.settings
                PythonDebug On
                PythonAutoReload On
                #AddHandler mod_python .py
                #PythonHandler mptest
                #PythonDebug On
                Options Indexes FollowSymLinks
                Order allow,deny
                Allow from all
        &lt;/Location&gt;

        &lt;Location &quot;/media/&quot;&gt;
                SetHandler None
        &lt;/Location&gt;

        &lt;LocationMatch &quot;\.(jpg|gif|png)$&quot;&gt;
                SetHandler None
        &lt;/LocationMatch&gt;
        ErrorLog /home/sam/www/apple/logs/error.log
        LogLevel warn

        CustomLog /home/sam/www/apple/logs/access.log combined
&lt;/VirtualHost&gt;
</pre>

<h4>Django gzip response on the fly</h4>

<pre class="example">MIDDLEWARE_CLASSES = (
    ...
    'django.middleware.gzip.GZipMiddleware',
)
</pre>

<h4>Check Version of Django</h4>

<pre class="example">&gt; import django
&gt; django.VERSION
</pre>

<h3>Psyco</h3>

<p>
加速python程序。

</p>

<h3>Twisted</h3>

<h4>twisted_server.py</h4>

<pre class="example">from twisted.internet import reactor,protocol
from twisted.protocols import basic

class PublishProtocol(basic.LineReceiver):
    def __init__(self):
        pass

    def lineReceived(self,line):
        if line == 'quit':
            self.sendLine(&quot;Goodbye.&quot;)
            self.transport.loseConnection()
        else:
            self.sendLine(line)

    def connectionMade(self):
        pass

    def connectionLost(self,reason):
        pass

class PublishServerFactory(protocol.ServerFactory):
    protocol = PublishProtocol

    def __init__(self):
        pass

    def startFactory(self):
        pass

    def stopFactory(self):
        pass

if __name__ == &quot;__main__&quot;:
    port=5001
    reactor.listenTCP(port,PublishServerFactory())
    reactor.run()
</pre>

<h4>twisted_client.py</h4>

<pre class="example">from twisted.internet import reactor,protocol

class QuickDisconnectProtocol(protocol.Protocol):
    def connectionMade(self):
        print &quot;Connected to %s.&quot;%self.transport.getPeer().host
        self.transport.write(&quot;Hello&quot;)
        self.transport.write('\r\n')
        #self.transport.read()
        self.transport.loseConnection()

    def dataReceived(self,data):
        self.transport.write(data)

class BasicClientFactory(protocol.ClientFactory):
    protocol=QuickDisconnectProtocol
    def clientConnectionLost(self,connector,reason):
        print 'Lost connection: %s'%reason.getErrorMessage()
        reactor.stop()
    def clientConnectionFailed(self,connector,reason):
        print 'Connection failed: %s'%reason.getErrorMessage()
        reactor.stop()

if __name__ == &quot;__main__&quot;:
    if sys.argv[1] == &quot;&quot;:

    reactor.connectTCP('10.10.243.100',5001,BasicClientFactory())
    reactor.run()
</pre>

<h3>Tornado </h3>

<p>
A non-block async IO web server framework created by Friendfeed.com, open sourced by Facebook.com

</p>

<h3>Python  Module by C language</h3>

<h4>C module source file</h4>

<pre class="example">#include &lt;Python.h&gt; 
static PyObject * seri07_system(PyObject * self, PyObject * args)
{
    char *command;
    int sts;
    if (!PyArg_ParseTuple(args, &quot;s&quot;, &amp;command))
        return NULL;
    sts = system(command);
    return Py_BuildValue(&quot;i&quot;, sts);
}
static PyMethodDef Seri07Methods[] = {
    {&quot;system&quot;, seri07_system, METH_VARARGS,
     &quot;Execute a shell command.&quot;},
    {NULL, NULL, 0, NULL}      
};
void initseri07(void)
{
    Py_InitModule(&quot;seri07&quot;, Seri07Methods);
}
</pre>

<h4>Module build</h4>

<p>
Build a setup.py file

</p>

<pre class="example">from distutils.core import setup, Extension
module1 = Extension('seri07',
                 sources = ['seri07module.c'])
setup (name = 'seri07 package',
    version = '1.0',
    description = 'This is a seri07 package',
    ext_modules = [module1])
</pre>

<p>
Build 

</p>

<pre class="example">$ python setup.py build
$ cp build/lib.linux-i686-2.5/seri07.so .
</pre>

<p>
Use the built module

</p>

<pre class="example">import seri07
seri07.system('ls')
</pre>

<h3>Python 技巧</h3>

<h4>Python 编译</h4>

<p>
编译test.py为test.pyc文件:

</p>

<pre class="example">import py_compile
py_compile.compile('test.py')
</pre>

<h4>列表操作</h4>

<pre class="example">[ k.upper() for k in list_A if k.isalpha() ]
</pre>

<h4>将一个列表逆序</h4>

<pre class="example">a = (1, 2, 3)
b = a[::-1]
b == (3, 2, 1)
</pre>

<h4>去字串空格</h4>

<p>
s.strip() == s.rstrip().lstrip()

</p>

<h4>md5</h4>

<pre class="example">import hashlib
m = hashlib.md5('strings')
m.hexdigest()

&gt;&gt;&gt; '8bcf6629759bd278a5c6266bd9c054f8'
</pre>

<h3>pipenv  --- 不再需要virtualenv和pip了</h3>

<h4>构建环境或克隆环境</h4>

<pre class="example">cd proj_dir
pipenv install
</pre>

<p>
以生成Pipfile, Pipfile.lock

</p>

<h4>安装包或卸载包</h4>

<pre class="example">pipenv install package_name
pipenv uninstall package_name
pipenv install --dev package_name  //只在开发环境安装
pipenv uninstall --all  //卸载所有包
</pre>

<h4>在环境下运行命令</h4>

<pre class="example">pipenv run ...
</pre>

<h4>升级环境下的包</h4>

<pre class="example">pipenv update
</pre>

<h4>安装指定版本的包</h4>

<pre class="example">pipenv install package_name==1.2.3
</pre>

<h4>查看环境下包的依赖关系</h4>

<pre class="example">pipenv graph
</pre>

<h4>环境下的shell</h4>

<pre class="example">pipenv shell
</pre>

<h4>生成Pipenv.lock</h4>

<pre class="example">pipenv lock
</pre>

<h4>删除环境</h4>

<pre class="example">pipenv --rm
</pre>
<!-- Page published by Emacs Wiki ends here -->
    <div class="navfoot">
      <hr />
      <table width="100%" border="0" summary="Footer navigation">
        <col width="33%"/><col width="34%"/><col width="33%"/>
        <tr>
          <td align="left">Update : 2018-09-23
          </td>
          <td align="center">
           <span class="foothome">
              <a href="WelcomePage.html">Home</a> / <a href="WikiIndex.html">Index</a>
            </span>
          </td>
          <td align="right">
           cyberpsyche[AT]gmail.com
          </td>
        </tr>
      </table>
   <center>
     Based on
      <a href="http://www.debian.org"><img style="border: 0em none;" src="images/debianLogo.png" alt="Debian Logo" /></a>    
   <a href="http://www.debian.org"><img style="border: 0em none;" src="images/debian.png" alt="Debian Text Logo" /></a>   
       GNU/Linux&nbsp;and&nbsp;<a href="http://www.apple.com"><img style="border: 0em none;" src="images/MacLogo.jpg" alt="Mac Logo" /></a>OS X|&nbsp;Powered by    
      <a href="http://www.gnu.org/software/emacs"><img style="border: 0em none;" src="images/emacs.gif" alt="Emacs Logo" /></a>&nbsp;|   
      Best view with    
   <a href="http://www.getfirefox.com/"><img style="border: 0em none;" src="images/getFirefox.gif" alt="Firefox Logo" /></a> 
  </center>  
  </div>
  </body>
</html>